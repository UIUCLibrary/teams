<script>
    window.addEventListener("load", function () {
        $(".remove-user").click(function(){
            // $(this).css('color','red');
            // $(this).next().css('background', 'red');
            // $(this).parent().parent().parent().parent().parent().toggleClass('delete');
            // $(this).closest("td").toggleClass('delete');
            $(this).closest("tr").toggleClass('delete');
            if ($(this).closest("tr").hasClass('delete')){
                $(this).closest("tr").find("select").attr('disabled', true)
            } else {$(this).closest("tr").find("select").removeAttr('disabled')}



            $(this).toggleClass('o-icon-delete');
            $(this).toggleClass('fa');
            $(this).toggleClass('fa-undo');

        });
    })

</script>
<?php
$translate = $this->plugin('translate');
$escape = $this->plugin('escapeHtml');

$this->htmlElement('body')->appendAttribute('class', 'items edit');


$sectionNavs = [
'team-info' => $translate('Info'),
'team-members' => $translate('Users'),
'team-resources' => $translate('Resources'),
];
?>
<?php echo $this->sectionNav($sectionNavs, 'view.show.section_nav'); ?>

<h1>Update Team for <? echo $this->api()->read('users', $this->ident)->getContent()->name()?></h1>
<div id="page-actions">
    <!--    --><?php //if ($item->userIsAllowed('update')): ?>
    <button type="submit" form="team-update-form" value="Submit">Save Edits</button>
    <!--    --><?php //endif; ?>
</div>
<?php
$form = $this->form;

$form->prepare();

echo $this->form()->openTag($form);?>

<div id="team-info" class="active section">
    <div class="meta-group"><?php

        echo $this->formCollection($form);


        ?>
    </div>


</div>
<?php

echo $this->form()->openTag($form);?>

<div id="team-members" class="section">
    <div class="meta-group">
        <div class="field">
            <div class="field-meta">
                <label for="add-member-choice">Add a User to the Team:</label>
            </div>

            <div class="input" id="role">
                <select class="chosen-select" data-placeholder="Username"
                        id="new-member-choice" name="add-member" >
                    <? foreach ($available_u_array as $id => $member):
                        echo '<option value="' .  $id .'" id="user' . $id . '">'.  $member . '</option>';
                    endforeach;
                    ?>
                </select>
            </div>
            <div class="input" id="role">
                <select class="chosen-select" data-placeholder="Username"
                        id="new-member-choice" name="member-role" >
                    <? foreach ($roles as $role):
                        echo '<option value="' .  $role->getId() .'" id="user' . $role->getId() . '">'.  $role->getName() . '</option>';
                    endforeach;
                    ?>
                </select>
            </div>
            <div class="input" id="role">
                <input class="btn btn-default"  style="margin-left: 20px;" type="submit" name="addUser" value="Add User" />

            </div>


        </div>













        </div>

        <div class="field">
            <div class="field-meta">
                Current Users:
            </div>

            <?php if (count($this->team_u_collection)> 0): ?>
                <table class="tablesaw batch-edit" data-tablesaw-mode="stack">
                    <thead>
                    <tr>
                        <th>

                        </th>
                        <th>
                            <?php echo $translate('Name'); ?>
                        </th>
                        <th><?php echo $translate('Role'); ?></th>
                        <th><?php echo $translate('Created'); ?></th>
                    </tr>
                    </thead>
                    <tbody>
                    <?php foreach ($this->team_u_collection as $team_user):
                        $user_name =  $team_user->getUser()->getName();
                        $user_id = $team_user->getUser()->getId();
                        $role_name = $team_user->getRole()->getName();
                        $role_id = $team_user->getRole()->getid();

                        ?>

                        <tr>
                            <td>
                                <ul class="actions">
                                    <li>

                                        <a href="#" class="o-icon-delete remove-user" title="Remove team" aria-label="Remove team"></a>
                                    </li>
                                 </ul>
                            </td>

                            <td>

                                    <?php echo $user_name ?>


                            </td>
                            <td>
                                <fieldset name="user-roles" id="user-roles">
<!--                                    <a class="o-icon-edit"></a>-->
                                    <select  id="UserRole[<?php echo $user_id?>]" name="<?php echo sprintf('User[%s]', $user_id)?>">
                                        <option value="<?php echo $team_user->getRole()->getId()?>"> <?php echo $team_user->getRole()->getName()?> </option>
                                        <?php foreach ($this->roles as $role):
                                            if ($role->getId() !== $team_user->getRole()->getId())
                                            {
                                                ?> <option value="<?php echo $role->getId();?>"><?php echo $role->getName();?></option> <?php
                                            }
                                        endforeach; ?>


                                    </select>
                                </fieldset>


                            </td>
                            <td><?php echo 'need to make this or put some info that makes more sense here'; ?></td>
                        </tr>
                    <?php endforeach; ?>
                    </tbody>
                </table>
            <?php else: ?>
                <div class="-resources">
                    <p><?php echo $translate('No users currently belong to this team.'); ?></p>
                    <!--            <a href="--><?// echo $this->url('admin/teams/detail/update', ['id' => $team->id()])?><!--">Add a Resource</a>-->
                </div>
            <?php endif; ?>
        </div>

    </div>
<div id="team-resources" class="section">


    <div class="selection-criteria">
        <p>
            All items belonging to these itemsets or owners will be added to the group
        </p>
        <div class="select-by-item-set-content">

            <?

            $itemsetForm = $this->itemsetForm;
            $itemsetForm->setAttribute('id', 'itemset_collection');

            foreach ($itemsetForm->getFieldsets() as $fs):
                $fs->setName('addCollections');
            endforeach;

            $itemsetForm->prepare();

            echo $this->form()->openTag($itemsetForm);

            echo $this->formCollection($itemsetForm);
            echo $this->form()->closeTag($itemsetForm)
            ?>

        </div>

        <div class="select-by-item-set-content">

            <p>
                All resources belonging to these itemsets or owners will be removed from the group
            </p>
            <?

            $rm_itemsetForm = $this->itemsetForm;
            $rm_itemsetForm->setAttribute('id', 'rm_itemset_collection');

            foreach ($rm_itemsetForm->getFieldsets() as $fs):
                $fs->setName('rmCollections');
            endforeach;

            $rm_itemsetForm->prepare();

            echo $this->form()->openTag($rm_itemsetForm);

            echo $this->formCollection($rm_itemsetForm);
            echo $this->form()->closeTag($rm_itemsetForm)
            ?>

        </div>

    </div>

</div>

<?php
echo $this->form()->closeTag();
?>

