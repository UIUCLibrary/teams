<h1>Add New Team</h1>
<div id="page-actions">
    <!--    --><?php //if ($item->userIsAllowed('update')): ?>
    <button type="submit" form="team-add-form" value="Submit">Add Team</button>
    <!--    --><?php //endif; ?>
</div>
<?php

$translate = $this->plugin('translate');
$escape = $this->plugin('escapeHtml');

//$this->htmlElement('body')->appendAttribute('class', 'items edit');
$sectionNavs = [
    'team-info' => $translate('Info'),
    'team-members' => $translate('Users'),
    'team-resources' => $translate('Resources'),
];
echo $this->sectionNav($sectionNavs, 'view.add.section_nav');
?>

<div id="team-info" class="active section">
    <div class="meta-group">

<?php



$form = $this->form;
$form->setAttribute('action', $this->url());
$form->prepare();

echo $this->form()->openTag($form);

echo $this->formCollection($form);

?>
    </div>
</div>

<div id="team-members" class="section">
    <div class="meta-group">
        <div class="field">
            <div class="field-meta">
                <label for="add-member-choice">Add a User to the Team:</label>
            </div>
            <div class="input">
                <input list="add-member-options" id="new-member-choice" name="add-member-choice" />
            </div>


            <datalist id="add-member-options">
                <? foreach (array_keys($this->available_u_array) as $member):
                    echo '<option value="' .  $member .'" id="user' . $this->available_u_array[$member] . '"> ';
                endforeach;
                ?>
            </datalist>



            <div >
                <label for="add-member-role">Role:</label>
            </div>
            <div class="input">
                <input list="add-member-role" id="new-member-role" name="add-member-role" />
            </div>


            <datalist id="add-member-role">
                <? foreach (array_keys($this->roles) as $role):
                    echo '<option value="' .  $role .'"> ';
                endforeach;
                ?>
            </datalist>
            <script>
                function removeRow(id,u){
                    let row = document.getElementById(id);
                    row.parentElement.removeChild(row);
                    let user_options = document.getElementById("add-member-options");
                    let option = document.createElement('option');

                    option.setAttribute('value', u);
                    option.setAttribute('id', id);

                    user_options.appendChild(option);


                }

                users = <? echo json_encode($this->available_u_array);?>;
                roles = <? echo json_encode($this->roles);?>;
                function addUser() {
                    let nm = document.getElementById("new-member-choice");
                    let nmr = document.getElementById("new-member-role");

                    alert(users[nm.value]);


                    let row = document.createElement('tr');
                    row.id = "u" + users[nm.value];
                    let userNameTd = document.createElement('td');
                    let trashA = document.createElement('a');
                    trashA.setAttribute("class", "o-icon-delete");
                    trashA.setAttribute("onclick", "removeRow('" + row.id +"', '"+ nm.value + "')");
                    userNameTd.appendChild(trashA);
                    let userA = document.createElement('a');
                    userA.setAttribute('href', window.location.hostname + '/admin/user' + nm.value);
                    userA.innerText = nm.value;
                    userNameTd.appendChild(userA);
                    row.appendChild(userNameTd);
                    document.getElementById("user-table").appendChild(row);

                    let roleTd = document.createElement('td');
                    roleTd.innerText = nmr.value ;

                    let user_option = document.getElementById(users[nm.value]);





                    row.appendChild(roleTd);
                    nmr.value = "";
                    nm.value = "";














                }
            </script>
            <div style="margin-left: 20px; ">
                <btn class="btn btn-default" onclick="addUser()"  >add</btn>
            </div>
        </div>
        <div class="field">
            <div class="field-meta">
                Current Users:
            </div>
                <table class="tablesaw batch-edit" data-tablesaw-mode="stack">
                    <thead>
                    <tr>
                        <th>
                            <?php echo $translate('Name'); ?>
                        </th>
                        <th><?php echo $translate('Role'); ?></th>
                        <th><?php echo $translate('Created'); ?></th>
                    </tr>
                    </thead>
                    <tbody id="user-table">

                    </tbody>
                </table>

        </div>

    </div>
</div>


<?php
echo $this->form()->closeTag();
